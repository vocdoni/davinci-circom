# DAVINCI Circom

This repository includes the zkSnark circuits and cryptographic primitives that allows to prove a valid vote in the [DAVINCI](https://davinci.vote) protocol, including the format of the vote itself and its encryption (elGamal). 

The circuits are optimized for the **BLS12-377** curve and use [poseidon377](https://github.com/vocdoni/poseidon377) for hashing.

 * **Ballot checker** ([`ballot_checker.circom`](./circuits/ballot_checker.circom)): Checks that the ballot is valid under the params provided as inputs.
 * **Ballot cipher** ([`ballot_cipher.circom`](./circuits/ballot_cipher.circom)): Encrypts the ballot fields using ElGamal on the BLS12-377 Twisted Edwards curve and checks if they match with the provided ones.
 * **Ballot proof** ([`ballot_proof.circom`](./circuits/ballot_proof.circom)): Checks the ballot and its encryption, calculates the vote ID, and verifies the hash of all public/private inputs using Poseidon377 MultiHash.

## Usage

Use the provided `Makefile` to handle dependencies, compilation, and testing:

*   **`make`**: Prepares the circuits and runs the full Go test suite.
*   **`make prepare`**: Compiles the default circuits and installs necessary tools (`circom`, `snarkjs`).
*   **`make test`**: Runs the Go test suite (includes native and recursive aggregation tests).
*   **`make webapp`**: Starts the Proof Generator React Webapp in the browser.

## Circom2Gnark

The [`circom2gnark`](./circom2gnark) package provides utilities to bridge Circom and Gnark ecosystems for **BLS12-377**. It enables converting Circom/SnarkJS proofs into Gnark-compatible formats for recursive verification inside Gnark circuits (using the BW6-761 curve).

This is critical for the DAVINCI node, allowing validation of vote proofs (generated by voters in the browser) within the recursive aggregation circuit.

## Requirements

 * [Go](https://go.dev/) (1.22+)
 * [Node & NPM](https://nodejs.org/)
 * [Rust](https://www.rust-lang.org/) (Required for some dependencies)